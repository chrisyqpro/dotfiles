set -g history-limit 1000000

set -g default-terminal "tmux-256color"

if-shell 'test -n "$WSL_DISTRO_NAME"' {
    set -ag terminal-overrides ",xterm-256color:RGB"
    set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'  # undercurl support
    set -as terminal-overrides ',*:Setulc=\E[58::2::::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m' # underscore colours - needs tmux-3.0 (wsl2 in Windows Terminal)
} {
    set -ag terminal-features "alacritty:RGB:usstyle"
}

# Styles
set -g message-style "bg=default,fg=yellow,bold"
set -g status-style  "bg=default"

set -g status-interval 4
set -g status-position top
set -g status-justify absolute-centre

set -g status-left "#S"
set -g status-right "#{?client_prefix,#[fg=black]#[bg=magenta]Prefix,}"

set -g window-status-current-style "fg=brightblue bold underscore"
set -g window-status-activity-style "fg=yellow"
set -g window-status-bell-style     "fg=red"

# unbind the prefix and bind it to ctrl-space
unbind C-b
set -g prefix `
bind ` send-prefix

set -g base-index 1
set -g renumber-windows on
set -sg escape-time 50 # Avoid ESC delay

# Mouse friendly
set -g mouse on
setw -g monitor-activity on
set -g visual-activity on

# Smooth scrolling
bind -T copy-mode-vi WheelUpPane send -N1 -X scroll-up
bind -T copy-mode-vi WheelDownPane send -N1 -X scroll-down

# Keybind
set -g mode-keys vi

bind Escape copy-mode

unbind r
bind r source-file "~/.config/tmux/tmux.conf" # force a reload of the config file

# y and p as in vim
bind p paste-buffer
bind-key -T copy-mode-vi "v" send -X begin-selection
bind-key -T copy-mode-vi "y" send -X copy-selection

# Split pane commands
bind \\ split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind "\""
unbind %

# Move between panes with vi keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Moving between windows with vim movement keys
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# Resize panes with vim movement keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Run things
bind D run-shell "$DOTFILES/scripts/tmux_spawn_session.sh ~/.config"
bind f run-shell "tmux neww $DOTFILES/scripts/tmux_spawn_session.sh"
bind H run-shell "$DOTFILES/scripts/tmux_spawn_session.sh ~"
bind g neww -c "#{pane_current_path}" -n "lazygit" lazygit
bind E show-environment -g
